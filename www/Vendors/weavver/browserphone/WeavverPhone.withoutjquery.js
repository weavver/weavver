var swfobject=function(){function a(){if(!y){try{var c=e.getElementsByTagName("body")[0].appendChild(e.createElement("span"));c.parentNode.removeChild(c)}catch(f){return}y=!0;for(var c=F.length,j=0;j<c;j++)F[j]()}}function b(c){y?c():F[F.length]=c}function m(c){if(typeof q.addEventListener!=h)q.addEventListener("load",c,!1);else if(typeof e.addEventListener!=h)e.addEventListener("load",c,!1);else if(typeof q.attachEvent!=h){var f=q;f.attachEvent("onload",c);A[A.length]=[f,"onload",c]}else if("function"==
typeof q.onload){var j=q.onload;q.onload=function(){j();c()}}else q.onload=c}function L(){var c=w.length;if(0<c)for(var f=0;f<c;f++){var j=w[f].id,a=w[f].callbackFn,g={success:!1,id:j};if(0<d.pv[0]){var b=r(j);if(b)if(G(w[f].swfVersion)&&!(d.wk&&312>d.wk))z(j,!0),a&&(g.success=!0,g.ref=M(j),a(g));else if(w[f].expressInstall&&N()){g={};g.data=w[f].expressInstall;g.width=b.getAttribute("width")||"0";g.height=b.getAttribute("height")||"0";b.getAttribute("class")&&(g.styleclass=b.getAttribute("class"));
b.getAttribute("align")&&(g.align=b.getAttribute("align"));for(var e={},b=b.getElementsByTagName("param"),n=b.length,l=0;l<n;l++)"movie"!=b[l].getAttribute("name").toLowerCase()&&(e[b[l].getAttribute("name")]=b[l].getAttribute("value"));O(g,e,j,a)}else ca(b),a&&a(g)}else if(z(j,!0),a){if((j=M(j))&&typeof j.SetVariable!=h)g.success=!0,g.ref=j;a(g)}}}function M(c){var f=null;if((c=r(c))&&"OBJECT"==c.nodeName)typeof c.SetVariable!=h?f=c:(c=c.getElementsByTagName(u)[0])&&(f=c);return f}function N(){return!H&&
G("6.0.65")&&(d.win||d.mac)&&!(d.wk&&312>d.wk)}function O(c,f,j,a){H=!0;P=a||null;U={success:!1,id:j};var b=r(j);if(b){"OBJECT"==b.nodeName?(D=Q(b),I=null):(D=b,I=j);c.id=V;if(typeof c.width==h||!/%$/.test(c.width)&&310>parseInt(c.width,10))c.width="310";if(typeof c.height==h||!/%$/.test(c.height)&&137>parseInt(c.height,10))c.height="137";e.title=e.title.slice(0,47)+" - Flash Player Installation";a=d.ie&&d.win?"ActiveX":"PlugIn";a="MMredirectURL="+q.location.toString().replace(/&/g,"%26")+"&MMplayerType="+
a+"&MMdoctitle="+e.title;f.flashvars=typeof f.flashvars!=h?f.flashvars+("&"+a):a;d.ie&&(d.win&&4!=b.readyState)&&(a=e.createElement("div"),j+="SWFObjectNew",a.setAttribute("id",j),b.parentNode.insertBefore(a,b),b.style.display="none",function(){4==b.readyState?b.parentNode.removeChild(b):setTimeout(arguments.callee,10)}());R(c,f,j)}}function ca(c){if(d.ie&&d.win&&4!=c.readyState){var f=e.createElement("div");c.parentNode.insertBefore(f,c);f.parentNode.replaceChild(Q(c),f);c.style.display="none";(function(){4==
c.readyState?c.parentNode.removeChild(c):setTimeout(arguments.callee,10)})()}else c.parentNode.replaceChild(Q(c),c)}function Q(c){var f=e.createElement("div");if(d.win&&d.ie)f.innerHTML=c.innerHTML;else if(c=c.getElementsByTagName(u)[0])if(c=c.childNodes)for(var a=c.length,b=0;b<a;b++)!(1==c[b].nodeType&&"PARAM"==c[b].nodeName)&&8!=c[b].nodeType&&f.appendChild(c[b].cloneNode(!0));return f}function R(c,f,a){var b,g=r(a);if(d.wk&&312>d.wk)return b;if(g)if(typeof c.id==h&&(c.id=a),d.ie&&d.win){var s=
"",k;for(k in c)c[k]!=Object.prototype[k]&&("data"==k.toLowerCase()?f.movie=c[k]:"styleclass"==k.toLowerCase()?s+=' class="'+c[k]+'"':"classid"!=k.toLowerCase()&&(s+=" "+k+'="'+c[k]+'"'));k="";for(var n in f)f[n]!=Object.prototype[n]&&(k+='<param name="'+n+'" value="'+f[n]+'" />');g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+k+"</object>";J[J.length]=c.id;b=r(c.id)}else{n=e.createElement(u);n.setAttribute("type",K);for(var l in c)c[l]!=Object.prototype[l]&&("styleclass"==
l.toLowerCase()?n.setAttribute("class",c[l]):"classid"!=l.toLowerCase()&&n.setAttribute(l,c[l]));for(s in f)f[s]!=Object.prototype[s]&&"movie"!=s.toLowerCase()&&(c=n,k=s,l=f[s],a=e.createElement("param"),a.setAttribute("name",k),a.setAttribute("value",l),c.appendChild(a));g.parentNode.replaceChild(n,g);b=n}return b}function W(c){var f=r(c);f&&"OBJECT"==f.nodeName&&(d.ie&&d.win?(f.style.display="none",function(){if(4==f.readyState){var a=r(c);if(a){for(var b in a)"function"==typeof a[b]&&(a[b]=null);
a.parentNode.removeChild(a)}}else setTimeout(arguments.callee,10)}()):f.parentNode.removeChild(f))}function r(c){var a=null;try{a=e.getElementById(c)}catch(b){}return a}function G(c){var a=d.pv,c=c.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return a[0]>c[0]||a[0]==c[0]&&a[1]>c[1]||a[0]==c[0]&&a[1]==c[1]&&a[2]>=c[2]?!0:!1}function X(c,a,b,t){if(!d.ie||!d.mac){var g=e.getElementsByTagName("head")[0];if(g){b=b&&"string"==typeof b?b:"screen";t&&(S=v=null);if(!v||
S!=b)t=e.createElement("style"),t.setAttribute("type","text/css"),t.setAttribute("media",b),v=g.appendChild(t),d.ie&&(d.win&&typeof e.styleSheets!=h&&0<e.styleSheets.length)&&(v=e.styleSheets[e.styleSheets.length-1]),S=b;d.ie&&d.win?v&&typeof v.addRule==u&&v.addRule(c,a):v&&typeof e.createTextNode!=h&&v.appendChild(e.createTextNode(c+" {"+a+"}"))}}}function z(c,a){if(Y){var b=a?"visible":"hidden";y&&r(c)?r(c).style.visibility=b:X("#"+c,"visibility:"+b)}}function Z(c){return null!=/[\\\"<>\.;]/.exec(c)&&
typeof encodeURIComponent!=h?encodeURIComponent(c):c}var h="undefined",u="object",K="application/x-shockwave-flash",V="SWFObjectExprInst",q=window,e=document,x=navigator,aa=!1,F=[function(){if(aa){var c=e.getElementsByTagName("body")[0],a=e.createElement(u);a.setAttribute("type",K);var b=c.appendChild(a);if(b){var t=0;(function(){if(typeof b.GetVariable!=h){var e=b.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),d.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>t){t++;
setTimeout(arguments.callee,10);return}c.removeChild(a);b=null;L()})()}else L()}else L()}],w=[],J=[],A=[],D,I,P,U,y=!1,H=!1,v,S,Y=!0,d,da=typeof e.getElementById!=h&&typeof e.getElementsByTagName!=h&&typeof e.createElement!=h,B=x.userAgent.toLowerCase(),C=x.platform.toLowerCase(),ea=C?/win/.test(C):/win/.test(B),C=C?/mac/.test(C):/mac/.test(B),B=/webkit/.test(B)?parseFloat(B.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,T=!+"\v1",E=[0,0,0],p=null;if(typeof x.plugins!=h&&typeof x.plugins["Shockwave Flash"]==
u){if((p=x.plugins["Shockwave Flash"].description)&&!(typeof x.mimeTypes!=h&&x.mimeTypes[K]&&!x.mimeTypes[K].enabledPlugin))aa=!0,T=!1,p=p.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),E[0]=parseInt(p.replace(/^(.*)\..*$/,"$1"),10),E[1]=parseInt(p.replace(/^.*\.(.*)\s.*$/,"$1"),10),E[2]=/[a-zA-Z]/.test(p)?parseInt(p.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof q.ActiveXObject!=h)try{var ba=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(ba&&(p=ba.GetVariable("$version")))T=!0,p=p.split(" ")[1].split(","),
E=[parseInt(p[0],10),parseInt(p[1],10),parseInt(p[2],10)]}catch(fa){}d={w3:da,pv:E,wk:B,ie:T,win:ea,mac:C};d.w3&&((typeof e.readyState!=h&&"complete"==e.readyState||typeof e.readyState==h&&(e.getElementsByTagName("body")[0]||e.body))&&a(),y||(typeof e.addEventListener!=h&&e.addEventListener("DOMContentLoaded",a,!1),d.ie&&d.win&&(e.attachEvent("onreadystatechange",function(){"complete"==e.readyState&&(e.detachEvent("onreadystatechange",arguments.callee),a())}),q==top&&function(){if(!y){try{e.documentElement.doScroll("left")}catch(c){setTimeout(arguments.callee,
0);return}a()}}()),d.wk&&function(){y||(/loaded|complete/.test(e.readyState)?a():setTimeout(arguments.callee,0))}(),m(a)));d.ie&&d.win&&window.attachEvent("onunload",function(){for(var c=A.length,a=0;a<c;a++)A[a][0].detachEvent(A[a][1],A[a][2]);c=J.length;for(a=0;a<c;a++)W(J[a]);for(var b in d)d[b]=null;d=null;for(var e in swfobject)swfobject[e]=null;swfobject=null});return{registerObject:function(c,a,b,e){if(d.w3&&c&&a){var g={};g.id=c;g.swfVersion=a;g.expressInstall=b;g.callbackFn=e;w[w.length]=
g;z(c,!1)}else e&&e({success:!1,id:c})},getObjectById:function(c){if(d.w3)return M(c)},embedSWF:function(c,a,e,t,g,s,k,n,l,m){var p={success:!1,id:a};d.w3&&!(d.wk&&312>d.wk)&&c&&a&&e&&t&&g?(z(a,!1),b(function(){e+="";t+="";var b={};if(l&&typeof l===u)for(var d in l)b[d]=l[d];b.data=c;b.width=e;b.height=t;d={};if(n&&typeof n===u)for(var q in n)d[q]=n[q];if(k&&typeof k===u)for(var r in k)d.flashvars=typeof d.flashvars!=h?d.flashvars+("&"+r+"="+k[r]):r+"="+k[r];if(G(g))q=R(b,d,a),b.id==a&&z(a,!0),p.success=
!0,p.ref=q;else{if(s&&N()){b.data=s;O(b,d,a,m);return}z(a,!0)}m&&m(p)})):m&&m(p)},switchOffAutoHideShow:function(){Y=!1},ua:d,getFlashPlayerVersion:function(){return{major:d.pv[0],minor:d.pv[1],release:d.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(a,b,e){if(d.w3)return R(a,b,e)},showExpressInstall:function(a,b,e,h){d.w3&&N()&&O(a,b,e,h)},removeSWF:function(a){d.w3&&W(a)},createCSS:function(a,b,e,h){d.w3&&X(a,b,e,h)},addDomLoadEvent:b,addLoadEvent:m,getQueryParamValue:function(a){var b=e.location.search||
e.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return Z(b);for(var b=b.split("&"),d=0;d<b.length;d++)if(b[d].substring(0,b[d].indexOf("="))==a)return Z(b[d].substring(b[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(H){var a=r(V);a&&D&&(a.parentNode.replaceChild(D,a),I&&(z(I,!0),d.ie&&d.win&&(D.style.display="block")),P&&P(U));H=!1}}}}();"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0==this.indexOf(a)});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)});
function getBaseURL(){var a=$("script[src]").filter(function(){return this.src.toLowerCase().endsWith("weavverphonelib.js")||this.src.toLowerCase().endsWith("weavverphone.js")}).first(),b=document.createElement("a");b.href=a.attr("src");a=b.pathname;0<a.lastIndexOf("/")&&(a=a.substr(0,a.lastIndexOf("/")+1),a.startsWith("/")&&(a=a.substr(1)));b.path=a;return baseurl=b.protocol+"//"+b.host+"/"+a}
$(document).ready(function(){getBaseURL();$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",baseurl+"jquery-ui-1.9.2.custom.min.css"));"undefined"==typeof swfobject&&$("head").append($('<script type="text/javascript" />').attr("src",baseurl+"swfobject.js"));$.get(baseurl+"WeavverPhone.tpl.html",function(a){$('a[href^="tel:"], a[href^="sip:"]').each(function(){var a=$(this).attr("id");a||(a=getPseudoGuid(),$(this).attr("id",a));var m=$(this).attr("href");$(this).data("teluri",
m);$(this).attr("href","javascript:showPhone('"+a+"')");$(this).append('<img id="'+a+'_phone" style="padding-left: 2px;" align="absmiddle" src="'+baseurl+'/images/Phone.png" height="35px" />');$(this).hover(function(){var a=$(this).attr("id");$("#"+a+"_phone").attr("src",baseurl+"/images/PhoneOver.png")},function(){var a=$(this).attr("id");$("#"+a+"_phone").attr("src",baseurl+"/images/Phone.png")})});$("body").append(a);$("#startcall").hide();$("#hangupcall").hide();$("#phonewidget").dialog({autoOpen:!1,
title:"Browser Phone",resizable:!1});$("a","#controls").button({disabled:!0});$("#phonewidget").dialog({beforeClose:function(){"true"==$("#phonewidget").data("flashLoaded")&&hangupCall();return!0}})})});$(window).resize(function(){$("#phonewidget").dialog("option","position","center")});function getPseudoGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}
function onInit(){$("#flash").attr("visibility","none");var a=eval($("#flash")[0].micList()),b=$("#input_source"),m=$("#flash")[0].getMic();b.children().remove();$("#status").text("Initializing...");for(i=0;i<a.length;i++)b.append("<option value='"+i+"' "+(i==m?"selected":"")+" >"+a[i]+"</option");$("#phonewidget").data("flashLoaded","true")}function onConnected(){$("#status").text("Ready");$("#status").hide();$("#startcall").show()}
function makeCall(a,b,m){a||(a=$("#startcall").data("telnum"));$("#controls").show();$("#phonewidget").dialog("option","position","center");$("#flash")[0].makeCall(a,b,m);$("#phonewidget").data("state","STARTINGCALL");$("#timer").data("time",0);setTimeout("timerTick()",1E3)}function onDebug(a){$(document).append(a)}var params={allowScriptAccess:"always"};
function showPhone(a){var b=getBaseURL();"false"!=$("#phonewidget").data("flashLoaded")&&("undefined"==typeof weavverPhoneOptions&&(weavverPhoneOptions={rtmp_url:"rtmp://205.134.225.23/phone"}),swfobject.embedSWF(b+"WeavverBrowserPhone.swf","flash","10","10","9.0.0","expressInstall.swf",weavverPhoneOptions,params,[]));$("#phonewidget").dialog("open");$("#timer").data("time",0);$("#timer").html("");var b=$("#"+a).data("teluri"),m=b.startsWith("sip:")?b:findBaseName(b);$("#startcall").data("telnum",
m);a=$("#"+a).clone(!1);a.children("img").remove();a=getParameterByName(b,"ActionText")||a.html();$("#startcall").html(a)}function onCallState(a,b){"ACTIVE"==b&&($("#startcall").hide(),$("#phonewidget").data("uuid",a),$("#hangupcall").show(),$("a","#controls").button({disabled:!1}));$("#phonewidget").data("state",b)}
function timerTick(){var a=$("#timer").data("time"),a=a+1;$("#timer").data("time",a);$("#timer").text(a+" second(s)");"HANGUP"!=$("#phonewidget").data("state")?setTimeout("timerTick()",1E3):$("#timer").data("time",0)}function onIncomingCall(){alert("incoming call")}function sendDTMF(a,b){$("#flash")[0].sendDTMF(a,b)}function hangupCall(){$("#hangupcall").attr("disabled","disabled");$("#flash")[0].hangup($("#phonewidget").data("uuid"))}
function onHangup(){$("#phonewidget").data("uuid",null);$("#hangupcall").hide();$("#startcall").show();$("#controls").hide();$("#phonewidget").dialog("option","position","center")}function getParameterByName(a,b){var b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),m=RegExp("[\\?&]"+b+"=([^&#]*)").exec(a);return null==m?null:decodeURIComponent(m[1].replace(/\+/g," "))}
function findBaseName(a){var a=a.replace("tel://",""),a=a.replace("tel:/",""),a=a.replace("tel:",""),b=a.indexOf("/");0<b&&(a=a.substring(0,b));b=a.indexOf("?");0<b&&(a=a.substring(0,b));return a};
